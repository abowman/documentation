<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Creo Spotify class description">
    <title>Creo: Spotify</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700,800">
    <link rel="stylesheet" href="../scripts/highlight/styles/github-gist.css">
    <link rel="stylesheet" href="../stylesheets/styles.css">
  </head>
  <body>

    <!-- Fixed navbar -->
     <nav class="navbar navbar-default navbar-fixed-top">
       <div class="container">
         <div class="navbar-header">
           <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
             <span class="sr-only">Toggle navigation</span>
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
           </button>
           <a class="navbar-brand" href="http://creolabs.com"><img src="../images/logo.png" width="36" height="36" alt="Creolabs"></a>
         </div>
         <div id="navbar" class="navbar-collapse collapse">
           <ul class="nav navbar-nav navbar-right">
             <li><a href="../creo/what-is-creo.html">Creo</a></li>
             <li><a href="../classes/ActivityIndicator.html">Classes</a></li>
             <li><a href="../gravity/getting-started.html">Gravity</a></li>
             <li class="active"><a href="../tutorials/lets-cook-nav.html">Tutorials</a></li>
           </ul>
         </div><!--/.nav-collapse -->
       </div>
     </nav>

     <div class="container body-container">
       <div class="main-content">
       	<div class="row">
       		<div class="col-sm-3 border-right section-left">
       			<div saveheight="1" class="sidebar-nav">
       			<h4>TUTORIALS</h4>
				<ul>
					<li><a href="browser.html"><span>Browser</span></a></li>
					<li><a href="lets-cook-nav.html"><span>Lets Cook Nav</span></a></li>
					<li><a href="lets-cook-split.html"><span>Lets Cook Split</span></a></li>
					<li><a href="spotify.html" class="active"><span>Spotify</span></a></li>
					<li><a href="ebook.html"><span>eBook</span></a></li>
					<li><a href="heart-rate.html"><span>Heart Rate</span></a></li>
					<li><a href="photo-gallery.html"><span>Photo Gallery</span></a></li>
					<li><a href="file-manager.html"><span>File Manager</span></a></li>
					<li><a href="gesture-recognizer.html"><span>Gesture Recognizer</span></a></li>
					<li><a href="freehand-drawing.html"><span>Freehand Drawing</span></a></li>
					<li><a href="todo.html"><span>ToDo</span></a></li>
				</ul>

       			</div>
       		</div>

       		<div class="col-sm-9 border-left section-right">
         	<h1 class="section-header">Spotify (with OAuth2 Authentication)</h1>
			<hr>
			
			<!-- IMPORTANT -->
			<p class="section-content">
			<span class="label label-danger">IMPORTANT</span></br>
			Starting from 29th May 2017 Spotify changes authentications for the API we used in this example. We update the tutorial and we added support for OAuth2 authentication. The official statement can be read on the <a class="stronglink" href="https://developer.spotify.com/news-stories/2017/01/27/removing-unauthenticated-calls-to-the-web-api/">Spotify Developer</a> news section. 
			</p>
			<br>
			<br>
			
			<!-- INTRO -->			
			<p class="section-content">
			<span class="label label-tutorial">Concepts</span><br>
			<ul style="list-style: none;">
			<li>The Spotify tutorial will show you how to use the powerful HTTPClient class to perform REST queries to a service like Spotify. It also shows you how to interact with a REST service to perform queries based on user's input. More information about Spotify REST API can be found in the <a href="https://developer.spotify.com/web-api/">Spotify Web API Developer</a> official documentation.
			</li>
			</ul>
			<br>
			</p>
			
			<!-- USED CLASSES -->		
			<p class="section-content">
			<span class="label label-tutorial">Classes</span><br>
			<ul style="list-style: none;">
				<li><a href="../classes/HTTPClient.html">HTTPClient</a></li>
				<li><a href="../classes/TableView.html">TableView</a></li>
				<li><a href="../classes/TextField.html">TextField</a></li>
				<li><a href="../classes/Button.html">Button</a></li>
			</ul>
			<br>
			</p>
						
			<!-- ASSETS TO DOWNLOAD -->
			<p class="section-content">
			<span class="label label-tutorial">Assets</span><br>
			<ul style="list-style: none;">
			<li>None</li>
			</ul>
			<br>
			</p>
						
			<!-- TUTORIAL -->
			<p class="section-content">
			<span class="number-badge"><span>1</span></span> Create a new empty Creo project and start by dragging a TableView from Objects to Window1. In TableView1 Cell Inspector section set Height to 90 and Template to Subtitle (in this example we will not create a CustomView object but we'll use a built-in one, a Subtitle template gives an Image, a Title and a Subtitle field):
			<img class="section-image fullscreen-shadow"src="../images/tutorials/spotify-2.png" width="800" height="584" alt="spotify">
			<br>
			<span class="number-badge"><span>2</span></span> Now drag an HTTPClient class from Objects (Network group) to Window1:
			<img class="section-image" src="../images/tutorials/spotify1.gif" width="700" height="491" alt="Spotify">
			<br>
			<span class="number-badge"><span>3</span></span> According to the official Spotify documentation the REST API endpoint is the url: https://api.spotify.com, so enter it in the HTTPClient configuration panel:
			<img class="section-image fullscreen-shadow"src="../images/tutorials/spotify-3.png" width="800" height="584" alt="spotify">
			Rename the object HTTPClient1 in the Layout section with a more appropriate Spotify name.
			<br><br>
			<span class="number-badge"><span>4</span></span> Starting from 29th May 2017 Spotify changes authentications for the API we used in this example so we need to add support for OAuth2. Start by connecting to <a href="https://developer.spotify.com">https://developer.spotify.com</a> (create a new account if needed) and then create a new App:
			<img class="section-image fullscreen-shadow"src="../images/tutorials/spotify-10.png" width="800" height="547" alt="spotify">
			<br>
			<span class="number-badge"><span>5</span></span> Setup Redirect URIs and Bundle IDs and you'll receive a Client ID and a Client Secret. Two different Redirect URI are needed: one custom Redirect URI specific for your App (in this example: "com.creolabs.spotifydemo://oauth2Callback") that is used when the App runs in a real device and the Creo default redirect URI "com.creolabs.creo://oauth2Callback" used to be able to test the App in the Creo simulator within the Mac IDE and in the CreoPlayer.
			<img class="section-image fullscreen-shadow"src="../images/tutorials/spotify-11.png" width="800" height="547" alt="spotify">
			<br>
			<span class="number-badge"><span>6</span></span> To allow your app to be launched using an URL (in this case the custom Redirect URI), youâ€™ll need to add a few entries to the App property list. To do that, open the Properties panel from the "Main Menu" -> "Project" -> "Properties...", add an Array with name "CFBundleURLTypes"if not existing, add a Dictionary in this array, add an array named "CFBundleURLSchemes" in the Dictionary and finally add a string with the scheme part of the custom Redirect URI (i.e. "com.creolabs.spotifydemo"):
			<img class="section-image fullscreen-shadow"src="../images/tutorials/spotify-13.png" width="800" height="563" alt="spotify">
			<br>
			<span class="number-badge"><span>7</span></span> Double click on the HTTPClient object and modify its settings according to the data entered into the Spotify Developer panel:
			<img class="section-image fullscreen-shadow"src="../images/tutorials/spotify-12.png" width="800" height="563" alt="spotify">
			<br>
			<span class="number-badge"><span>8</span></span> Once you set the main endpoint you can start creating your HTTPRequest objects (only one in this example). Right click on the Spotify object and select "New Request". The HTTPRequest panel will show:
			<img class="section-image fullscreen-shadow"src="../images/tutorials/spotify-4.png" width="800" height="584" alt="spotify">
			<br>
			<span class="number-badge"><span>9</span></span> We want to create an app that lets you search for albums based on artist's name. So the right Spotify API to use seems the <a href="https://developer.spotify.com/web-api/search-item/">Search Item</a> API. It expects two parameters, a mandatory type parameter (that can be album, artist, playlist or track) and a q parameter (the search keyword). To test our HTTPRequest enter the query <strong>v1/search/?q=adele&type=album</strong> in the Request field. You can notice under the Query section that Creo automatically parsed that query and creates dynamically properties that we'll use later.
			<img class="section-image fullscreen-shadow"src="../images/tutorials/spotify-5.png" width="800" height="584" alt="spotify">
			<br>
			<span class="number-badge"><span>10</span></span> Like a Database query, this panel offers you a convenient way to test your request using the Test Connection button:
			<img class="section-image fullscreen-shadow"src="../images/tutorials/spotify-6.png" width="800" height="584" alt="spotify">
			<br>
			<span class="number-badge"><span>11</span></span> It is now time to connect TableView1 with the newly created DataSet. So select TableView1 and in the Inspector set the following Cell properties:
			<ul>
			<li><strong>DataSet</strong> Spotify.Request</li>
			<li><strong>KeyPath</strong> albums.items</li>
			<li><strong>Text</strong> name</li>
			<li><strong>Detail Text</strong> albums_type</li>
			<li><strong>Image</strong> images.[0].url</li>
			<li>... and lets the magic happens...</li>
			</ul>
			<img class="section-image fullscreen-shadow"src="../images/tutorials/spotify-7.png" width="800" height="584" alt="spotify">
			<br>
			Creo is able to extract JSON query data while in design mode and display all of them inside your custom views. It is now time to add a way to query Spotify. 
			<br><br>
			<span class="number-badge"><span>12</span></span> Drag a TextField and a Button from Object to Window1 and set Button1 title to Search. Window1 now looks like:
			<img class="section-image fullscreen-shadow"src="../images/tutorials/spotify-8.png" width="800" height="584" alt="spotify">
			<br>
			<span class="number-badge"><span>13</span></span> When the user touches the Search button we would like to run a new HTTPRequest with the newly entered text and display the result into TableView1. So, select Button1 and open the Code Editor. Then select the Action event and enter the following code:
			<pre><code class="swift">
			Keyboard.hide();
			Spotify.Request.q = TextField1.text;
			Spotify.Request.run();
			</code></pre>
			This very short code performs some importants steps:<br>
			<strong>1.</strong> Hide the Keyboard because each time the user enters text into a TextField the Keyboard appears automatically<br>
			<strong>2.</strong> Do you remember that Creo automatically created the q dynamic property based on the HTTPRequest? It is a very powerful shortcut because it allows you to modify its value (default to Adele) with the text the user just entered without the needs to rewrite the entire HTTP request.<br>
			<strong>3.</strong> The HTTPRequest object has a run method that automatically refresh all connected objects (in this case TableView1).
			<img class="section-image fullscreen-shadow"src="../images/tutorials/spotify-9.png" width="800" height="584" alt="spotify">
			<br>
			<span class="number-badge"><span>14</span></span> Press RUN and enjoy the Spotify app!
			<img class="section-image" src="../images/tutorials/spotify2.gif" width="700" height="493" alt="Spotify">
			
			You can now send the app to <a href="../creo/creoplayer.html">CreoPlayer</a> or <a href="../creo/build-your-app.html">build it</a> and then submit to the App Store.
			</p>
						
			<!-- FINAL PROJECT -->
			<p class="section-content">
			<br><br>
			<span class="label label-tutorial">Project</span><br>
			Please note that in the downloadable project there is <strong>no support for Auth2 authentication</strong> (we cannot share the Client ID and the Client Secret, so you need to follow steps 4, 5 and 6 in order to obtain a fully functional project).
			<ul style="list-style: none;">
				<li><a href="../assets/spotify.zip">Spotify.creoproject</a> (78KB)</li>
			</ul>
			<br>
			</p>
						
			<p class="section-footer"></p>
         	</div>
       	</div> <!-- /row -->
       </div> <!-- /main-content -->
     </div> <!-- /container -->

	<footer class="navbar-fixed-bottom">
      <div class="container footer">
      	<p>
      	<span class="footer-left">Documentation version 20180719</span>
        <span class="footer-right"><a href="http://community.creolabs.com">Community</a> | <a href="http://blog.creolabs.com">Blog</a> | &copy;2018 Creolabs Inc.</span>
        </p>
      </div>
    </footer>
	
	<!-- Bootstrap JS -->
	<script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	
	<!-- Highlights JS -->
    <script src="../scripts/highlight/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    
    <!-- Google Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-6839205-1', 'auto');
    ga('send', 'pageview');
	</script>
	</body>
</html>
